<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<title>ç”Ÿæ—¥ç¤¼ç‰©</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<style>
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  font-family:"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;
  color:#fff;
  background:linear-gradient(to bottom,#000428,#004e92);
  -webkit-tap-highlight-color: transparent;
}

#gift-screen{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
#gift-box{
  font-size:120px;
  animation:pulse 1.2s infinite ease-in-out;
  user-select:none;
}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}

.particle{
  position:absolute;
  width:7px;
  height:7px;
  background:#ffd85c;
  border-radius:50%;
  pointer-events:none;
  animation:boom .9s ease-out forwards;
}
@keyframes boom{to{transform:translate(var(--dx),var(--dy)) scale(0);opacity:0}}

#main-screen{
  position:absolute;
  inset:0;
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:0 20px;
  text-align:center;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
#text-box{
  font-size:22px;
  line-height:1.9;
  max-width:620px;
  padding:30px 0;
  word-break: break-word;
}

.snow-container{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  pointer-events:none;
  overflow:hidden;
}
.snowflake{
  position:absolute;
  top:-60px;
  pointer-events:none;
  background-size:contain;
  background-repeat:no-repeat;
  will-change:transform, top;
}

.trail-particle{
  position:absolute;
  width:4px;
  height:4px;
  border-radius:50%;
  background-color:rgba(255,255,255,0.8);
  opacity:0;
  pointer-events:none;
  filter:blur(1px);
}

.stars{
  position:absolute;
  width:2px;
  height:2px;
  background:#fff;
  border-radius:50%;
  animation:twinkle 3s ease-in-out infinite;
}
@keyframes twinkle{0%,100%{opacity:.2}50%{opacity:1}}

/* æ‰‹åŠ¨æ’­æ”¾æŒ‰é’®æ ·å¼ */
#manual-play-btn {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10000;
  padding: 12px 24px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 30px;
  font-size: 16px;
  font-weight: bold;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  cursor: pointer;
  display: none; /* é»˜è®¤éšè— */
}
#manual-play-btn.error {
  background: #ff6b6b;
}

@media screen and (max-width: 768px) {
  #gift-box {
    font-size: 80px;
  }
  
  #text-box {
    font-size: 18px;
    line-height: 1.8;
    max-width: 90%;
    padding: 20px 0;
  }
  
  #main-screen {
    padding: 0 15px;
    justify-content: flex-start;
    padding-top: 20px;
  }
  
  .particle {
    width: 5px;
    height: 5px;
  }
  
  .trail-particle {
    width: 3px;
    height: 3px;
  }
  
  .snowflake {
    max-width: 40px;
    max-height: 40px;
  }
  
  #manual-play-btn {
    padding: 10px 20px;
    font-size: 14px;
    bottom: 15px;
  }
}

@media screen and (max-width: 480px) {
  #gift-box {
    font-size: 60px;
  }
  
  #text-box {
    font-size: 16px;
    line-height: 1.7;
    max-width: 95%;
  }
  
  #main-screen {
    padding: 0 10px;
    padding-top: 15px;
  }
}

@media screen and (orientation: landscape) and (max-height: 500px) {
  #text-box {
    font-size: 16px;
    line-height: 1.6;
    max-height: 80vh;
    overflow-y: auto;
  }
  
  #main-screen {
    justify-content: flex-start;
    padding-top: 10px;
  }
}

@supports (-webkit-touch-callout: none) {
  body {
    height: -webkit-fill-available;
  }
}
</style>
</head>
<body>

<audio id="bgm" loop muted playsinline>
  <source src="bgm.MP3" type="audio/mpeg">
</audio>

<div id="gift-screen">
  <div id="gift-box">ğŸ</div>
</div>

<div id="main-screen">
  <div id="text-box"></div>
</div>

<button id="manual-play-btn">ğŸµ ç‚¹æ­¤å¼€å¯èƒŒæ™¯éŸ³ä¹</button>

<script>
// ============== é…ç½®åŒº ==============
const sentences = [
  "é‚“è‡ªç‘œï¼Œç¥ä½ 18å²ç”Ÿæ—¥å¿«ä¹ğŸ‚ï¼",
  "æ„¿ä½ æˆä¸ºè‡ªå·±ç‹¬ç‰¹çš„å‘å…‰ç‚¹âœ¨ã€‚",
  "æƒ³èµ·åˆšè®¤è¯†ä½ çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜åœ¨ç©ç€é£è¡Œæ£‹è¿˜è€èµ–ã€‚",
  "æ—¶é—´è¿‡å¾—çœŸå¿«ï¼Œå¤§å®¶éƒ½æ¸æ¸å˜å¾—æˆç†Ÿã€‚",
  "æˆ‘æƒ³é€ä½ ä¸€ä»½æ¯”è¾ƒç‰¹åˆ«çš„ç”Ÿæ—¥ç¤¼ç‰©ã€‚",
  "å› ä¸ºæˆ‘ä¹Ÿåœ¨æè½¯ä»¶ç¼–ç¨‹å’Œå¼€å‘åº”ç”¨ç›¸å…³çš„ï¼Œç»™ä½ å¼€å‘è½¯ä»¶æ°¸è¿œæ‰“8æŠ˜å“ˆå“ˆï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨å­¦ä¹ æˆ–å·¥ä½œä¸­é‡åˆ°æŠ€æœ¯éš¾é¢˜å°¤å…¶æ˜¯ä¿®ä»£ç ï¼Œå¯ä»¥éšæ—¶æ‰¾æˆ‘èŠèŠï¼ˆè‡ªå–è‡ªå¤¸ï¼‰ã€‚",
  "ç„¶åå…¶å®æˆ‘ä¸€ç›´éƒ½å–œæ¬¢ç€ä½ çš„ï¼ˆä¸æ˜¯å‘Šç™½ï¼Œæˆ‘å°±æ˜¯å¦¹æ§ï¼‰ï¼Œæ‰€ä»¥æˆ‘å¸Œæœ›èƒ½æˆä¸ºä½ çš„å¥½æœ‹å‹ã€‚",
  "æœ€åï¼Œå¸Œæœ›è¿™å°ç”µå­è´ºå¡èƒ½ç»™ä½ å¸¦æ¥å¿«ä¹ï¼",
  "å†æ¬¡ç¥ä½ 18å²ç”Ÿæ—¥å¿«ä¹ï¼Œæˆå¹´å¿«ä¹å“¦âœ¨ï¼",
   "psï¼šåƒåœ¾å¾®ä¿¡ï¼Œæˆ‘æœ¬æ¥å¤‡æ¡ˆçš„åŸŸåï¼Œå«ç”Ÿæ—¥å¿«ä¹.siteï¼Œæµè§ˆå™¨å¯ä»¥ç›´æ¥æ‰“å¼€ï¼Œä½†å¾®ä¿¡ä¸æ”¯æŒä¸­æ–‡åŸŸåï¼Œå®³å¾—æˆ‘åªèƒ½æŠŠä¸­æ–‡ç»™è½¬è¯‘äº†ï¼Œå˜å¾—å¥½éš¾å¬çš„åŸŸåï¼Œè€Œä¸”bgmæœ‰æ—¶ä¹Ÿä¼šå‡ºbug...."
];

const snowImgs = ['snow1.png', 'snow2.png', 'snow3.png'];
let cleanupSnow = null; // é›ªèŠ±æ¸…ç†å‡½æ•°

// ============== å·¥å…·å‡½æ•° ==============

// æ‰“å­—æœºæ•ˆæœ
async function typeWriter(el, text, speed = 110) {
    for (let c of text) {
        el.textContent += c;
        await new Promise(r => setTimeout(r, speed));
    }
    el.innerHTML += '<br>';
}

// åˆ›å»ºæ‹–å°¾ç²’å­
function createTrailParticle(x, y, size, color) {
    const trail = document.createElement('div');
    trail.className = 'trail-particle';
    trail.style.left = x + 'px';
    trail.style.top = y + 'px';
    trail.style.width = size + 'px';
    trail.style.height = size + 'px';
    trail.style.backgroundColor = color;
    
    trail.animate([
        { opacity: 0.8, transform: 'scale(1)' },
        { opacity: 0, transform: 'scale(1.3)' }
    ], {
        duration: 1000,
        easing: 'ease-out'
    });
    
    document.body.appendChild(trail);
    
    setTimeout(() => {
        if (trail.parentNode) trail.parentNode.removeChild(trail);
    }, 1000);
}

// é›ªèŠ±æ•ˆæœ
function startSnow() {
    const snowContainer = document.createElement('div');
    snowContainer.className = 'snow-container';
    document.body.appendChild(snowContainer);
    
    const snowflakes = [];
    
    function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        
        const size = 20 + Math.random() * 30;
        snowflake.style.width = size + 'px';
        snowflake.style.height = size + 'px';
        
        const leftPos = Math.random() * 100;
        snowflake.style.left = leftPos + '%';
        
        const randomImg = snowImgs[Math.floor(Math.random() * snowImgs.length)];
        snowflake.style.backgroundImage = 'url(' + randomImg + ')';
        
        snowflake.style.opacity = 0.7 + Math.random() * 0.3;
        snowContainer.appendChild(snowflake);
        
        const screenHeight = window.innerHeight;
        const totalDistance = screenHeight + 100;
        const duration = 18000 + Math.random() * 12000;
        const startTime = Date.now();
        const rotationSpeed = 0.05 + Math.random() * 0.05;
        let rotation = Math.random() * 360;
        let lastTrailTime = 0;
        const trailInterval = 250;
        const microWobble = Math.random() * 0.5;
        
        function updateSnowflake() {
            const currentTime = Date.now();
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            if (progress >= 1) {
                if (snowflake.parentNode) {
                    snowflake.parentNode.removeChild(snowflake);
                }
                const index = snowflakes.indexOf(snowflake);
                if (index > -1) snowflakes.splice(index, 1);
                return;
            }
            
            const currentTop = -60 + progress * totalDistance;
            rotation += rotationSpeed;
            if (rotation >= 360) rotation -= 360;
            const microOffset = Math.sin(currentTime * 0.001) * microWobble;
            
            snowflake.style.top = currentTop + 'px';
            snowflake.style.transform = 'translateX(' + microOffset + 'px) rotate(' + rotation + 'deg)';
            
            if (currentTime - lastTrailTime > trailInterval) {
                const rect = snowflake.getBoundingClientRect();
                const x = rect.left + rect.width / 2;
                const y = rect.top + rect.height / 2;
                const trailSize = size * (0.2 + Math.random() * 0.15);
                const trailColor = 'rgba(255, 255, 255, ' + (0.4 + Math.random() * 0.3) + ')';
                createTrailParticle(x, y, trailSize, trailColor);
                
                lastTrailTime = currentTime;
            }
            
            requestAnimationFrame(updateSnowflake);
        }
        
        requestAnimationFrame(updateSnowflake);
        snowflakes.push(snowflake);
    }
    
    for (let i = 0; i < 35; i++) {
        setTimeout(() => createSnowflake(), i * 600);
    }
    
    const snowInterval = setInterval(() => {
        if (snowflakes.length < 50) {
            createSnowflake();
        }
    }, 900);
    
    return () => {
        clearInterval(snowInterval);
        if (snowContainer.parentNode) {
            snowContainer.parentNode.removeChild(snowContainer);
        }
    };
}

// æ·»åŠ æ˜Ÿæ˜Ÿ
function addStars() {
    for (let i = 0; i < 120; i++) {
        const s = document.createElement('div');
        s.className = 'stars';
        s.style.top = Math.random() * 100 + '%';
        s.style.left = Math.random() * 100 + '%';
        s.style.animationDelay = Math.random() * 3 + 's';
        document.body.appendChild(s);
    }
}

// ============== éŸ³é¢‘æ ¸å¿ƒé€»è¾‘ ==============
const bgm = document.getElementById('bgm');
const manualPlayBtn = document.getElementById('manual-play-btn');
let bgmPlayAttempted = false;

// 1. ä¼˜åŒ–é¢„åŠ è½½ç­–ç•¥
function preloadAudio() {
    bgm.muted = true;
    bgm.preload = 'auto';
    
    // é™éŸ³é¢„åŠ è½½
    const loadPromise = bgm.play();
    if (loadPromise !== undefined) {
        loadPromise.then(() => {
            bgm.pause();
            console.log('éŸ³é¢‘é¢„åŠ è½½æˆåŠŸ');
        }).catch(e => {
            console.log('é¢„åŠ è½½è¢«é˜»æ­¢ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’');
        });
    }
    
    bgm.muted = false;
}

// 2. æ’­æ”¾éŸ³é¢‘ï¼ˆä¸»å‡½æ•°ï¼‰
function playBackgroundMusic() {
    if (bgmPlayAttempted) return;
    
    bgmPlayAttempted = true;
    bgm.currentTime = 0;
    
    const playPromise = bgm.play();
    
    if (playPromise !== undefined) {
        playPromise.then(() => {
            console.log('BGMæ’­æ”¾æˆåŠŸ');
            manualPlayBtn.style.display = 'none';
        }).catch(error => {
            console.warn('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢:', error);
            showManualPlayButton();
        });
    }
}

// 3. æ˜¾ç¤ºæ‰‹åŠ¨æ’­æ”¾æŒ‰é’®
function showManualPlayButton() {
    manualPlayBtn.style.display = 'block';
    manualPlayBtn.textContent = 'ğŸµ ç‚¹æ­¤å¼€å¯èƒŒæ™¯éŸ³ä¹';
    manualPlayBtn.classList.remove('error');
}

// 4. æ‰‹åŠ¨æ’­æ”¾æŒ‰é’®äº‹ä»¶
manualPlayBtn.addEventListener('click', function() {
    bgm.play().then(() => {
        this.style.display = 'none';
    }).catch(e => {
        this.textContent = 'ğŸµ æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®';
        this.classList.add('error');
    });
});

// ============== ä¸»äº¤äº’é€»è¾‘ ==============
document.getElementById('gift-screen').addEventListener('click', function() {
    // è§¦å‘éŸ³é¢‘æ’­æ”¾
    playBackgroundMusic();
    
    // ç²’å­çˆ†ç‚¸æ•ˆæœ
    const box = document.getElementById('gift-box');
    const rect = box.getBoundingClientRect();
    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;
    
    for (let i = 0; i < 50; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const angle = Math.random() * Math.PI * 2;
        const dist = 60 + Math.random() * 140;
        p.style.setProperty('--dx', Math.cos(angle) * dist + 'px');
        p.style.setProperty('--dy', Math.sin(angle) * dist + 'px');
        p.style.left = cx + 'px';
        p.style.top = cy + 'px';
        document.body.appendChild(p);
        setTimeout(() => {
            if (p.parentNode) p.parentNode.removeChild(p);
        }, 900);
    }
    
    // åˆ‡æ¢ç”»é¢
    setTimeout(() => {
        document.getElementById('gift-screen').style.display = 'none';
        document.getElementById('main-screen').style.display = 'flex';
        addStars();
        cleanupSnow = startSnow();
        startTyping();
    }, 700);
});

// ============== é¡µé¢åˆå§‹åŒ– ==============
window.addEventListener('load', function() {
    console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹é¢„åŠ è½½éŸ³é¢‘');
    preloadAudio();
    
    // æ·»åŠ ç‰ˆæœ¬å‚æ•°é˜²æ­¢ç¼“å­˜
    const links = document.querySelectorAll('link[rel="stylesheet"], script[src]');
    links.forEach(link => {
        if (link.href) link.href += '?v=' + Date.now();
        if (link.src) link.src += '?v=' + Date.now();
    });
});

// æ‰“å­—æ•ˆæœ
async function startTyping() {
    const box = document.getElementById('text-box');
    box.innerHTML = '';
    for (let s of sentences) {
        await typeWriter(box, s);
        await new Promise(r => setTimeout(r, 500));
    }
}

// çª—å£å¤§å°å˜åŒ–
window.addEventListener('resize', function() {
    console.log('çª—å£å¤§å°å˜åŒ–ï¼Œå½“å‰å°ºå¯¸:', window.innerWidth, 'x', window.innerHeight);
});

// é˜²æ­¢ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾
let lastTouchEnd = 0;
document.addEventListener('touchend', function(event) {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) event.preventDefault();
    lastTouchEnd = now;
}, false);
</script>
</body>
</html>